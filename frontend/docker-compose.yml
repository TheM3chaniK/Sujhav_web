services:
  web:
    image: ${IMAGE_NAME}
    ports:
      - "${PORT}:3000"

    environment:
      NODE_ENV: production
    secrets:
      - google_service_account


    env_file:
      - .env

    deploy:
      replicas: 1

      restart_policy:
        condition: on-failure

      update_config:
        parallelism: 1
        delay: 10s
        order: start-first
        failure_action: rollback

      rollback_config:
        parallelism: 1
        delay: 10s


secrets:
  google_service_account:
    file: ./secrets/google-service-account.json
